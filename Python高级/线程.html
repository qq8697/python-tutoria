<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>线程 | Python Tutorial | Python 教程</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="python基础 python进阶 函数式编程 面向对象 面向对象高级 python高级应用 标准库 python web 网络爬虫 数据分析 机器学习 人工智能">
    <link rel="preload" href="/assets/css/0.styles.5d7dc79b.css" as="style"><link rel="preload" href="/assets/js/app.7982f4ec.js" as="script"><link rel="preload" href="/assets/js/2.5dc5b073.js" as="script"><link rel="preload" href="/assets/js/35.b646fa36.js" as="script"><link rel="prefetch" href="/assets/js/10.654901ba.js"><link rel="prefetch" href="/assets/js/11.697c57a7.js"><link rel="prefetch" href="/assets/js/12.d02015cf.js"><link rel="prefetch" href="/assets/js/13.c16a62ce.js"><link rel="prefetch" href="/assets/js/14.de19a7a9.js"><link rel="prefetch" href="/assets/js/15.9d03d6f9.js"><link rel="prefetch" href="/assets/js/16.9418409b.js"><link rel="prefetch" href="/assets/js/17.4958f8b1.js"><link rel="prefetch" href="/assets/js/18.ee667b78.js"><link rel="prefetch" href="/assets/js/19.91a453ac.js"><link rel="prefetch" href="/assets/js/20.22cba70d.js"><link rel="prefetch" href="/assets/js/21.2f41d179.js"><link rel="prefetch" href="/assets/js/22.0a3b6da0.js"><link rel="prefetch" href="/assets/js/23.622b0455.js"><link rel="prefetch" href="/assets/js/24.7a864e77.js"><link rel="prefetch" href="/assets/js/25.ed0f3e11.js"><link rel="prefetch" href="/assets/js/26.9f090891.js"><link rel="prefetch" href="/assets/js/27.cc2758de.js"><link rel="prefetch" href="/assets/js/28.2d548cd6.js"><link rel="prefetch" href="/assets/js/29.db7ea4f5.js"><link rel="prefetch" href="/assets/js/3.b3e15418.js"><link rel="prefetch" href="/assets/js/30.97d17e6a.js"><link rel="prefetch" href="/assets/js/31.91c61511.js"><link rel="prefetch" href="/assets/js/32.b36028c4.js"><link rel="prefetch" href="/assets/js/33.41d545bd.js"><link rel="prefetch" href="/assets/js/34.2184c568.js"><link rel="prefetch" href="/assets/js/36.063e2e44.js"><link rel="prefetch" href="/assets/js/37.231692c9.js"><link rel="prefetch" href="/assets/js/38.ee6c3dd9.js"><link rel="prefetch" href="/assets/js/39.8f62b81f.js"><link rel="prefetch" href="/assets/js/4.eb64ed62.js"><link rel="prefetch" href="/assets/js/40.a5e0f043.js"><link rel="prefetch" href="/assets/js/41.32cca7ae.js"><link rel="prefetch" href="/assets/js/42.cb388f2e.js"><link rel="prefetch" href="/assets/js/43.1c4c891a.js"><link rel="prefetch" href="/assets/js/44.01df042d.js"><link rel="prefetch" href="/assets/js/45.213858ad.js"><link rel="prefetch" href="/assets/js/46.7919d9c5.js"><link rel="prefetch" href="/assets/js/47.ceeba6ce.js"><link rel="prefetch" href="/assets/js/48.9e691e9e.js"><link rel="prefetch" href="/assets/js/49.e0129794.js"><link rel="prefetch" href="/assets/js/5.e7a472e3.js"><link rel="prefetch" href="/assets/js/50.829ee76e.js"><link rel="prefetch" href="/assets/js/51.09644ef8.js"><link rel="prefetch" href="/assets/js/52.76616846.js"><link rel="prefetch" href="/assets/js/53.1890f762.js"><link rel="prefetch" href="/assets/js/54.462975c8.js"><link rel="prefetch" href="/assets/js/55.0c16b1f3.js"><link rel="prefetch" href="/assets/js/56.264cfd64.js"><link rel="prefetch" href="/assets/js/57.afc88876.js"><link rel="prefetch" href="/assets/js/58.fa5ea1e9.js"><link rel="prefetch" href="/assets/js/59.39e09b5a.js"><link rel="prefetch" href="/assets/js/6.4a7ee40c.js"><link rel="prefetch" href="/assets/js/60.4810d7a9.js"><link rel="prefetch" href="/assets/js/61.88c19a39.js"><link rel="prefetch" href="/assets/js/62.d57d7d71.js"><link rel="prefetch" href="/assets/js/63.ad544e5a.js"><link rel="prefetch" href="/assets/js/64.dd8a029c.js"><link rel="prefetch" href="/assets/js/65.e844bc83.js"><link rel="prefetch" href="/assets/js/66.0228e563.js"><link rel="prefetch" href="/assets/js/67.c8e3b05b.js"><link rel="prefetch" href="/assets/js/68.22a32741.js"><link rel="prefetch" href="/assets/js/69.1662777a.js"><link rel="prefetch" href="/assets/js/7.ae21527b.js"><link rel="prefetch" href="/assets/js/8.72e0f139.js"><link rel="prefetch" href="/assets/js/9.891adc7f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d7dc79b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Python Tutorial | Python 教程</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          更多教程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://git.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://mysql.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mysql
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>
          更多作品
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://blog.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://nav.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端导航
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://snippet.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码碎片
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://mark2web.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mark2web
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/qq8697/python-tutorial" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="了解更多" class="dropdown-title"><span class="title">了解更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          更多教程
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://git.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Git
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://mysql.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mysql
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>
          更多作品
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://blog.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://nav.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端导航
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://snippet.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  代码碎片
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://mark2web.wuhongbin.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  mark2web
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/qq8697/python-tutorial" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>简介与环境搭建</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/简介与环境搭建/简介.html" class="sidebar-link">简介</a></li><li><a href="/简介与环境搭建/环境搭建.html" class="sidebar-link">环境搭建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python 基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python基础/基本概念.html" class="sidebar-link">基本概念</a></li><li><a href="/Python基础/变量和基本数据类型.html" class="sidebar-link">变量和基本数据类型</a></li><li><a href="/Python基础/数据结构.html" class="sidebar-link">数据结构</a></li><li><a href="/Python基础/流程控制.html" class="sidebar-link">流程控制</a></li><li><a href="/Python基础/函数.html" class="sidebar-link">函数</a></li><li><a href="/Python基础/模块和包.html" class="sidebar-link">模块和包</a></li><li><a href="/Python基础/异常处理.html" class="sidebar-link">异常处理</a></li><li><a href="/Python基础/文件操作.html" class="sidebar-link">文件操作</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>面向对象</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/面向对象/封装.html" class="sidebar-link">封装</a></li><li><a href="/面向对象/继承.html" class="sidebar-link">继承</a></li><li><a href="/面向对象/多态.html" class="sidebar-link">多态</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Python 进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python进阶/命名空间和变量的作用域.html" class="sidebar-link">命名空间和变量的作用域</a></li><li><a href="/Python进阶/Python特性.html" class="sidebar-link">Python特性</a></li><li><a href="/Python进阶/虚拟环境.html" class="sidebar-link">虚拟环境</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>函数式编程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/函数式编程/函数式编程概念.html" class="sidebar-link">函数式编程概念</a></li><li><a href="/函数式编程/函数式编程技术.html" class="sidebar-link">函数式编程技术</a></li><li><a href="/函数式编程/装饰器.html" class="sidebar-link">装饰器</a></li><li><a href="/函数式编程/偏函数.html" class="sidebar-link">偏函数</a></li><li><a href="/函数式编程/缓存函数.html" class="sidebar-link">缓存函数</a></li><li><a href="/函数式编程/Python内置高阶函数.html" class="sidebar-link">Python内置高阶函数</a></li><li><a href="/函数式编程/使用itertools构建工具函数.html" class="sidebar-link">使用itertools构建工具函数</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>面向对象高级</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/面向对象高级/再议封装.html" class="sidebar-link">再议封装</a></li><li><a href="/面向对象高级/再议继承.html" class="sidebar-link">再议继承</a></li><li><a href="/面向对象高级/类特殊成员.html" class="sidebar-link">类特殊成员</a></li><li><a href="/面向对象高级/迭代器与生成器.html" class="sidebar-link">迭代器与生成器</a></li><li><a href="/面向对象高级/上下文管理器.html" class="sidebar-link">上下文管理器</a></li><li><a href="/面向对象高级/限制实例的属性.html" class="sidebar-link">限制实例的属性</a></li><li><a href="/面向对象高级/property属性.html" class="sidebar-link">property属性</a></li><li><a href="/面向对象高级/type和元类.html" class="sidebar-link">type和元类</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Python 高级</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Python高级/正则表达式.html" class="sidebar-link">正则表达式</a></li><li><a href="/Python高级/线程.html" class="active sidebar-link">线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python高级/线程.html#threading-模块" class="sidebar-link">threading 模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python高级/线程.html#线程对象-thread" class="sidebar-link">线程对象 Thread</a></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#threading-模块提供的函数" class="sidebar-link">threading 模块提供的函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#创建线程" class="sidebar-link">创建线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python高级/线程.html#_1-使用-thread-构造函数" class="sidebar-link">1. 使用 Thread() 构造函数</a></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#_2-继承-thread-类" class="sidebar-link">2. 继承 Thread 类</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#线程通信" class="sidebar-link">线程通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python高级/线程.html#共享全局变量" class="sidebar-link">共享全局变量</a></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#线程非安全" class="sidebar-link">线程非安全</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#番外：同步机制" class="sidebar-link">番外：同步机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Python高级/线程.html#互斥锁" class="sidebar-link">互斥锁</a></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#死锁" class="sidebar-link">死锁</a></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#避免死锁" class="sidebar-link">避免死锁</a></li></ul></li><li class="sidebar-sub-header"><a href="/Python高级/线程.html#参考文档" class="sidebar-link">参考文档</a></li></ul></li><li><a href="/Python高级/进程.html" class="sidebar-link">进程</a></li><li><a href="/Python高级/协程.html" class="sidebar-link">协程</a></li><li><a href="/Python高级/异步编程.html" class="sidebar-link">异步编程</a></li><li><a href="/Python高级/socket套接字.html" class="sidebar-link">socket套接字</a></li><li><a href="/Python高级/UDP和TCP协议.html" class="sidebar-link">UDP和TCP协议</a></li><li><a href="/Python高级/HTTP协议.html" class="sidebar-link">HTTP协议</a></li><li><a href="/Python高级/数据库.html" class="sidebar-link">数据库</a></li><li><a href="/Python高级/SQL语句.html" class="sidebar-link">SQL语句</a></li><li><a href="/Python高级/MySQL数据库.html" class="sidebar-link">MySQL数据库</a></li><li><a href="/Python高级/pymysql模块.html" class="sidebar-link">pymysql模块</a></li><li><a href="/Python高级/SQLite数据库.html" class="sidebar-link">SQLite数据库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>标准库和第三方模块</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/标准库和第三方模块/pickle_对象序列化.html" class="sidebar-link">pickle_对象序列化</a></li><li><a href="/标准库和第三方模块/copy_深拷贝和浅拷贝.html" class="sidebar-link">copy_深拷贝和浅拷贝</a></li><li><a href="/标准库和第三方模块/weakref_弱引用.html" class="sidebar-link">weakref_弱引用</a></li><li><a href="/标准库和第三方模块/datetime_日期和时间数据类型.html" class="sidebar-link">datetime_日期和时间数据类型</a></li><li><a href="/标准库和第三方模块/collections_集合数据类型.html" class="sidebar-link">collections_集合数据类型</a></li><li><a href="/标准库和第三方模块/enum_枚举数据类型.html" class="sidebar-link">enum_枚举数据类型</a></li><li><a href="/标准库和第三方模块/logging_日志服务.html" class="sidebar-link">logging_日志服务</a></li><li><a href="/标准库和第三方模块/加密验证服务.html" class="sidebar-link">加密验证服务</a></li><li><a href="/标准库和第三方模块/电子邮件.html" class="sidebar-link">电子邮件</a></li><li><a href="/标准库和第三方模块/SMTP发送邮件.html" class="sidebar-link">SMTP发送邮件</a></li><li><a href="/标准库和第三方模块/POP3接收邮件.html" class="sidebar-link">POP3接收邮件</a></li><li><a href="/标准库和第三方模块/结构化数据处理.html" class="sidebar-link">结构化数据处理</a></li><li><a href="/标准库和第三方模块/二进制数据处理.html" class="sidebar-link">二进制数据处理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Web 开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Web开发/WSGI.html" class="sidebar-link">WSGI</a></li><li><a href="/Web开发/实现简单Web框架.html" class="sidebar-link">实现简单Web框架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>爬虫与数据分析</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>自动化运维与测试</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>人工智能和机器学习</span> <!----></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="线程"><a href="#线程" class="header-anchor">#</a> 线程</h1> <h2 id="threading-模块"><a href="#threading-模块" class="header-anchor">#</a> threading 模块</h2> <p>Python 内置的 <code>_thread</code> 模块是比较底层的模块，<code>threading</code> 模块是对 <code>_thread</code> 做了封装更方便被使用。</p> <p><code>threading</code> 模块的设计基于 Java 的线程模型：</p> <ul><li>在 Java 中，锁和条件变量是每个对象的基础特性，而在 Python ，这些被独立成了单独的对象；</li> <li>Python 的 Thread 类只是 Java 的 Thread 类的一个子集；目前还没有优先级，没有线程组，线程还不能被销毁、停止、暂停、恢复或中断。</li> <li>Java 的 Thread 类的静态方法在实现时会映射为模块级函数。</li></ul> <h3 id="线程对象-thread"><a href="#线程对象-thread" class="header-anchor">#</a> 线程对象 Thread</h3> <p><code>threading</code> 模块提供 <code>Thread</code> 类构造线程对象，调用签名如下：
<code>class threading.Thread(group=None, target=None, name=None, args=(), kwargs={}, *, daemon=None)</code></p> <ul><li><code>group</code> 为了日后扩展而保留。</li> <li><code>target</code> 用于 <code>run()</code> 方法调用的可调用对象。</li> <li><code>name</code> 线程名称。（每个线程都有一个名字，没有指定的话会设置默认值）</li> <li><code>args</code> 用于调用目标函数的参数元组。</li> <li><code>kwargs</code> 用于调用目标函数的关键字参数字典。</li> <li><code>daemon</code> 设置该线程是否为守护模式。</li></ul> <p>线程对象的方法和属性：</p> <ul><li><code>start()</code> 开始线程活动。（在一个线程里最多只能被调用一次）安排对象的 <code>run()</code> 方法在一个独立的控制线程中调用。</li> <li><code>run()</code> 代表线程活动。（子类需要重载该方法）</li> <li><code>join(timeout=None)</code> 等待，直到线程终结。</li> <li><code>is_alive()</code> / <code>name</code> / <code>getName()</code> / <code>ident</code> / <code>daemon</code></li></ul> <p>说明：</p> <ul><li>线程对象被创建后，其活动一定由线程的 <code>start()</code> 方法开始。这会在独立的控制线程调用 <code>run()</code> 方法。</li> <li>Python 程序里面初始的控制线程被认为是“主线程”。</li> <li>一旦线程活动开始，该线程被认为是“存活的”；当它的 <code>run()</code> 方法终结了，就不是“存活的”。</li> <li>其他线程调用一个线程的 <code>join()</code> 方法，这会阻塞调用该方法的线程，直到被调用 <code>join()</code> 方法的线程终结。</li> <li>剩下的线程都是守护线程时，整个 Python 程序将会退出。</li></ul> <h3 id="threading-模块提供的函数"><a href="#threading-模块提供的函数" class="header-anchor">#</a> <code>threading</code> 模块提供的函数</h3> <ul><li><code>main_thread()</code> 返回主 <code>Thread</code> 对象。（Python 解释器开始时创建的线程）</li> <li><code>current_thread()</code> 返回当前的 <code>Thread</code> 对象。</li> <li><code>get_ident()</code> 返回当前线程的 “线程标识符”（非零的整数）。</li></ul> <hr> <ul><li><code>active_count()</code> 返回当前存活的 <code>Thread</code> 对象的计数。</li> <li><code>enumerate()</code> 以列表形式返回当前所有存活的 <code>Thread</code> 对象。</li></ul> <hr> <ul><li><code>settrace(func)</code> 为所有的线程设置追踪函数。</li> <li><code>setprofile(func)</code> 为所有的线程设置性能测试函数。</li></ul> <hr> <h2 id="创建线程"><a href="#创建线程" class="header-anchor">#</a> 创建线程</h2> <h3 id="_1-使用-thread-构造函数"><a href="#_1-使用-thread-构造函数" class="header-anchor">#</a> 1. 使用 <code>Thread()</code> 构造函数</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

<span class="token keyword">def</span> <span class="token function">sing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;singing...%d&quot;</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">dance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;dancing...%d&quot;</span> <span class="token operator">%</span> i<span class="token punctuation">)</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>sing<span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>dance<span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 循环查看正在启动的线程</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 判断子线程是否已经结束</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><ol><li>调用 <code>Thread</code> 的时候不会创建线程，执行其返回的对象的 <code>start</code> 方法才会创建线程以及让这个线程开始运行。</li> <li>函数执行结束，子线程也随之结束。</li> <li>线程的执行顺序是不确定的，要看操作系统调度，<code>t1</code>，<code>t2</code> 加上主线程共 3 个线程，如果 <code>t1</code>, <code>t2</code> 线程内部没有 <code>sleep</code>，<code>threading.enumerate()</code> 执行的时候,<code>t1</code> 和 <code>t2</code> 存在多种可能：如子线程已经结束了，查看正在启动的线程只有主线程。</li> <li>子线程全部结束后，主线程结束。</li></ol> <h3 id="_2-继承-thread-类"><a href="#_2-继承-thread-类" class="header-anchor">#</a> 2. 继承 <code>Thread</code> 类</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 1. 通过继承Thread类创建线程</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">' @ '</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        t <span class="token operator">=</span> MyThread<span class="token punctuation">(</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># t = MyThread()</span>
    <span class="token comment"># t.start()</span>

	test<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol><li><code>run</code> 方法用于定义线程的功能函数，可以在自己的线程类中覆盖重写，当 <code>run</code> 方法结束时该线程结束。</li> <li>如果子类型重载了构造函数，它一定要确保在做任何事前，先发起调用基类构造器 <code>Thread.__init__()</code>。</li> <li>创建实例对象后，使用 <code>start</code> 启动线程，交给 Python 虚拟机进行调度，当该线程获得执行的机会时，就会调用 <code>run</code> 方法执行线程。</li> <li>从代码和执行结果可以看出，多线程程序的执行顺序是不确定的。<strong>当执行到 <code>sleep</code> 语句时，线程将被阻塞（Blocked），到 <code>sleep</code> 结束后，线程进入就绪（Runnable）状态，等待调度</strong>。而线程调度将自行选择一个线程执行。上面的代码中只能保证每个线程都运行完整个 <code>run</code> 函数，但是线程的启动顺序、 <code>run</code> 函数中每次循环的执行顺序都不能确定。</li></ol> <h2 id="线程通信"><a href="#线程通信" class="header-anchor">#</a> 线程通信</h2> <h3 id="共享全局变量"><a href="#共享全局变量" class="header-anchor">#</a> 共享全局变量</h3> <p><strong>在一个进程内的所有线程共享全局变量，很方便在多个线程间共享数据</strong>：</p> <ol><li>可以通过 <code>args</code> 参数，元组形式；</li> <li>也可以函数内 <code>global</code> 声明直接使用全局变量。</li></ol> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep<span class="token punctuation">,</span> ctime

gl_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">prt</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>add<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>gl_list<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>prt<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>gl_list<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="线程非安全"><a href="#线程非安全" class="header-anchor">#</a> 线程非安全</h3> <p>线程对全局变量随意修改可能造成多线程之间对全局变量的混乱，即<strong>线程非安全</strong>。</p> <p>假设两个线程 <code>t1</code> 和 <code>t2</code> 都要对全局变量 <code>g_num</code>（默认是 0）进行加 1 运算，<code>t1</code> 和 <code>t2</code> 都各对 <code>g_num</code> 加 10 次，<code>g_num</code> 的最终的结果应该为 20。</p> <p>但是由于是多线程同时操作，有可能出现下面情况：</p> <ol><li>在 <code>g_num</code> 等于 0 时，<code>t1</code> 取得 <code>g_num</code> 等于 0 。此时系统把 <code>t1</code> 调度为 “sleeping” 状态，把 <code>t2</code> 转换为 “running” 状态，<code>t2</code> 也获得 <code>g_num</code> 等于 0；</li> <li>然后 <code>t2</code> 对得到的值进行加 1 并赋给 <code>g_num</code>，使得 <code>g_num</code> 等于 1；</li> <li>然后系统又把 <code>t2</code> 调度为 “sleeping” ，把 <code>t1</code> 转为 “running” 。线程 <code>t1</code> 又把它之前得到的 0 加 1 后赋值给 <code>g_num</code>；</li> <li>这样导致 <code>t1</code> 和 <code>t2</code> 都对 <code>g_num</code> 加 1，但结果仍然是 <code>g_num</code> 等于 1。</li></ol> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

g_num <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">def</span> <span class="token function">work1</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> g_num
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        g_num <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;----in work1, g_num is %d---&quot;</span><span class="token operator">%</span>g_num<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">work2</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> g_num
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        g_num <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;----in work2, g_num is %d---&quot;</span><span class="token operator">%</span>g_num<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;---线程创建之前g_num is %d---&quot;</span><span class="token operator">%</span>g_num<span class="token punctuation">)</span>

t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>work1<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>work2<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;2个线程对同一个全局变量操作之后的最终结果是:%s&quot;</span> <span class="token operator">%</span> g_num<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h2 id="番外：同步机制"><a href="#番外：同步机制" class="header-anchor">#</a> 番外：同步机制</h2> <p>如果多个线程同时对同一个全局变量操作，会出现<strong>资源竞争</strong>问题，从而导致结果可能不正确。 此时，需要进行同步控制，线程<strong>同步能够保证多个线程安全访问竞争资源</strong>。</p> <h3 id="互斥锁"><a href="#互斥锁" class="header-anchor">#</a> 互斥锁</h3> <p>最简单的同步机制是引入互斥锁。<strong>互斥锁</strong>为资源引入一个状态：锁定/非锁定。某个线程要更改共享数据时，先将其锁定，此时资源的状态为“锁定”，其他线程不能更改；直到该线程释放资源，将资源的状态变成“非锁定”，其他的线程才能再次锁定该资源。互斥锁保证了每次只有一个线程进行写入操作，从而保证了多线程情况下数据的正确性。</p> <p>线程同步解决上一小节问题，思路如下:</p> <ol><li>系统调用 <code>t1</code>，然后获取到 <code>g_num</code> 的值为 0，此时上一把锁，即不允许其他线程操作 <code>g_num</code>；</li> <li><code>t1</code> 对 <code>g_num</code> 的值进行 <code>+1</code>；</li> <li><code>t1</code> 解锁，此时 <code>g_num</code> 的值为 1，其他的线程就可以使用 <code>g_num</code> 了，而且是 <code>g_num</code> 的值不是 0 而是 1；</li> <li>同理其他线程在对 <code>g_num</code> 进行修改时，都要先上锁，处理完后再解锁，在上锁的整个过程中不允许其他线程访问，就保证了数据的正确性。</li></ol> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

num <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># 创建一个互斥锁</span>
mutex <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 上锁，如果之前没有被上锁，此时上锁成功</span>
    <span class="token comment"># 如果已经被上锁，此时堵塞在这里，直到这个锁被解开</span>
    mutex<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> num
        num <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token comment"># 解锁</span>
    mutex<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 上锁</span>
    mutex<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> num
        num <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token comment"># 解锁</span>
    mutex<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>


t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>f1<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t2 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>f2<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 等待计算完成</span>
<span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span><span class="token builtin">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;2个线程对同一个全局变量操作之后的最终结果是:%s&quot;</span> <span class="token operator">%</span> num<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>锁的好处：</p> <ol><li>确保了某段关键代码只能由一个线程从头到尾完整地执行。</li></ol> <p>锁的坏处：</p> <ol><li>阻止了多线程并发执行，包含锁的某段代码实际上只能以单线程模式执行，效率就大大地下降了；</li> <li>由于可以存在多个锁，不同的线程持有不同的锁，并试图获取对方持有的锁时，可能会造成<strong>死锁</strong>。</li></ol> <h3 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h3> <p>死锁的例子：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># coding=utf-8</span>
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">MyThread1</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 对mutexA上锁</span>
        mutexA<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># mutexA上锁后，延时1秒，等待另外那个线程 把mutexB上锁</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'----do1---up----'</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment"># 此时会堵塞，因为这个mutexB已经被另外的线程抢先上锁了</span>
        mutexB<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'----do1---down----'</span><span class="token punctuation">)</span>
        mutexB<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 对mutexA解锁</span>
        mutexA<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">MyThread2</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 对mutexB上锁</span>
        mutexB<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># mutexB上锁后，延时1秒，等待另外那个线程 把mutexA上锁</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'----do2---up----'</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        <span class="token comment"># 此时会堵塞，因为这个mutexA已经被另外的线程抢先上锁了</span>
        mutexA<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">'----do2---down----'</span><span class="token punctuation">)</span>
        mutexA<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 对mutexB解锁</span>
        mutexB<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>

mutexA <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
mutexB <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    t1 <span class="token operator">=</span> MyThread1<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> MyThread2<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="避免死锁"><a href="#避免死锁" class="header-anchor">#</a> 避免死锁</h3> <ol><li>银行家算法（程序设计时要尽量避免死锁）；</li> <li>添加超时时间。</li></ol> <h2 id="参考文档"><a href="#参考文档" class="header-anchor">#</a> 参考文档</h2> <ol><li>官网 <a href="https://docs.python.org/3.5/library/threading.html" target="_blank" rel="noopener noreferrer">threading<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Python高级/正则表达式.html" class="prev">
        正则表达式
      </a></span> <span class="next"><a href="/Python高级/进程.html">
        进程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7982f4ec.js" defer></script><script src="/assets/js/2.5dc5b073.js" defer></script><script src="/assets/js/35.b646fa36.js" defer></script>
  </body>
</html>
