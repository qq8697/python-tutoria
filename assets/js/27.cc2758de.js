(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{386:function(s,t,n){"use strict";n.r(t);var a=n(25),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"sqlite"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlite"}},[s._v("#")]),s._v(" SQLite")]),s._v(" "),n("p",[s._v("SQLite，轻量级的基于磁盘的数据库，不需要独立的服务器进程，使用一种非标准的 SQL 查询语言来访问。")]),s._v(" "),n("h2",{attrs:{id:"sqlite-数据类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlite-数据类型"}},[s._v("#")]),s._v(" SQLite 数据类型")]),s._v(" "),n("p",[s._v("SQLite 原生支持如下的类型： "),n("code",[s._v("NULL")]),s._v("，"),n("code",[s._v("INTEGER")]),s._v("，"),n("code",[s._v("REAL")]),s._v("，"),n("code",[s._v("TEXT")]),s._v("，"),n("code",[s._v("BLOB")]),s._v("。 对应 Python 的 "),n("code",[s._v("None")]),s._v("， "),n("code",[s._v("int")]),s._v("， "),n("code",[s._v("float")]),s._v("， "),n("code",[s._v("str")]),s._v("， "),n("code",[s._v("bytes")]),s._v("。")]),s._v(" "),n("p",[s._v("sqlite3 模块的类型系统的扩展：")]),s._v(" "),n("ol",[n("li",[n("a",{attrs:{href:"https://docs.python.org/3.5/library/sqlite3.html#using-adapters-to-store-additional-python-types-in-sqlite-databases",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用适配器将额外的 Python 类型保存在 SQLite 数据库中"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://docs.python.org/3.5/library/sqlite3.html#converting-sqlite-values-to-custom-python-types",target:"_blank",rel:"noopener noreferrer"}},[s._v("将 SQLite 值转换为自定义 Python 类型"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"sqlite3-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlite3-api"}},[s._v("#")]),s._v(" sqlite3 API")]),s._v(" "),n("p",[n("code",[s._v("sqlite3.connect(database[, timeout, detect_types, isolation_level, check_same_thread, factory, cached_statements, uri])")]),s._v("，连接SQLite 数据库，默认返回数据库连接对象 "),n("code",[s._v("connection")]),s._v("，除非使用了自定义的 "),n("code",[s._v("factory")]),s._v(" 参数：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("timeout")]),s._v(" 指定了这个连接等待锁释放的超时时间（默认是 5.0（5秒）。（一个数据库被多个连接访问，如果其中一个进程修改这个数据库，在这个"),n("strong",[s._v("事务提交之前，这个数据库将会被一直锁定")]),s._v("）")]),s._v(" "),n("li",[n("code",[s._v("check_same_thread")]),s._v(" 默认为 "),n("code",[s._v("True")]),s._v("，只有当前线程可以使用该连接，如果设为 "),n("code",[s._v("False")]),s._v("，则多个线程可以共享返回的连接。 （当"),n("strong",[s._v("多个线程使用同一个连接的时候，用户应该把写操作进行序列化")]),s._v("，以避免数据损坏）")]),s._v(" "),n("li",[n("code",[s._v("cached_statements")]),s._v(" 设置当前连接可以缓存的语句数，默认100条。（sqlite3 模块在内部"),n("strong",[s._v("使用语句缓存来避免 SQL 解析开销")]),s._v("）")]),s._v(" "),n("li",[s._v("...")])]),s._v(" "),n("p",[n("code",[s._v("Connection")]),s._v(" 对象方法和属性：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("isolation_level")]),s._v(" 获取或设置当前默认的"),n("strong",[s._v("隔离级别")])]),s._v(" "),n("li",[n("code",[s._v("cursor(factory=Cursor)")]),s._v(" 返回游标对象 "),n("code",[s._v("cursor")])]),s._v(" "),n("li",[n("code",[s._v("commit()")]),s._v(" 提交当前事物，"),n("strong",[s._v("如果没有调用这个方法，那么从上一次提交 commit() 以来所有的变化在其他数据库连接上都是不可见的")]),s._v("。"),n("strong",[s._v("如果你往数据库里写了数据，但是又查询不到，请检查是否忘记了调用这个方法")]),s._v("。")]),s._v(" "),n("li",[n("code",[s._v("rollback()")]),s._v(" 回滚从上一次调用 commit() 以来所有数据库的改变")]),s._v(" "),n("li",[n("code",[s._v("close()")]),s._v(" 关闭数据库连接。注意，它不会自动调用 commit() 方法。"),n("strong",[s._v("如果在关闭数据库连接之前没有调用 commit()，那么你的修改将会丢失！")])]),s._v(" "),n("li",[s._v("...")])]),s._v(" "),n("p",[n("code",[s._v("Cursor")]),s._v(" 对象方法和属性：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("execute(sql[, parameters])")]),s._v(" 执行SQL语句。 可以是参数化 SQL 语句（即，在 SQL 语句中使用占位符）")]),s._v(" "),n("li",[n("code",[s._v("executemany(sql, seq_of_parameters)")])]),s._v(" "),n("li",[n("code",[s._v("executescript(sql_script)")]),s._v(" 一次执行多条 SQL 语句，会首先执行一条 COMMIT 语句，再执行以形参方式获取的 SQL 脚本。")]),s._v(" "),n("li",[n("code",[s._v("fetchone()")]),s._v(" 获取查询结果集的一行，返回一个单独序列，或是在没有更多可用数据时返回 None")]),s._v(" "),n("li",[n("code",[s._v("fetchmany(size=cursor.arraysize)")]),s._v(" 获取查询结果集的多行，返回一个列表，当没有更多可用行时将返回一个空列表。")]),s._v(" "),n("li",[n("code",[s._v("fetchall()")]),s._v(" 获取查询结果集的所有（剩余）行，返回一个列表，当没有可用行时将返回一个空列表。")]),s._v(" "),n("li",[n("code",[s._v("arraysize")]),s._v("，控制 fetchmany() 返回行数的可读取/写入属性，默认值为 1。")])]),s._v(" "),n("h2",{attrs:{id:"使用-sqlite3-连接-mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-sqlite3-连接-mysql"}},[s._v("#")]),s._v(" 使用 sqlite3 连接 MySQL")]),s._v(" "),n("h3",{attrs:{id:"创建数据表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建数据表"}},[s._v("#")]),s._v(" 创建数据表")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sqlite3\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 connection 对象")]),s._v("\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sqlite3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.db'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 cursor 对象")]),s._v("\ncursor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 sql 语句")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建表")]),s._v("\ncreate_table_sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v("'''CREATE TABLE stocks (\n\tshort text,\n\tchg text,\n\tturnover text,\n\tprice real,\n\thighs real,\n\ttime text)\n'''")]),s._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_table_sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭连接")]),s._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"插入数据（更新数据-删除数据略）"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插入数据（更新数据-删除数据略）"}},[s._v("#")]),s._v(" 插入数据（更新数据&删除数据略）")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sqlite3\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 connection 对象")]),s._v("\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sqlite3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.db'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 cursor 对象")]),s._v("\ncursor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 sql 语句")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 插入单条数据")]),s._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"INSERT INTO stocks VALUES ('皇庭国际','0.39%', '0.65%', '12.96','12.91','2017-07-20')\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nvalue "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'中集集团'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.35%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1.78%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'18.07'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'18.06'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-06-28'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ninsert_row_sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INSERT INTO stocks VALUES (?,?,?,?,?,?)"')]),s._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("insert_row_sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 插入多条数据")]),s._v("\nvalues "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'全新好'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.01%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'4.40%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'16.05'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'14.60'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-07-13'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'华联控股'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.04%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.80%'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'11.29'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.26'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2017-07-20'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ninser_row_sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"INSERT INTO stocks VALUES (?,?,?,?,?,?)"')]),s._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("executemany"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inser_row_sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 提交数据")]),s._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("commit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭连接")]),s._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("h3",{attrs:{id:"查询数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询数据"}},[s._v("#")]),s._v(" 查询数据")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" sqlite3\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 connection 对象")]),s._v("\nconn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" sqlite3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'example.db'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 cursor 对象")]),s._v("\ncursor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 sql 语句")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询数据")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# short_name = "中集集团"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# short_name = \"' or 1=1 or '1\"")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cursor.execute(\"SELECT * FROM stocks WHERE short = '%s'\" % short_name)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for stock in cursor.fetchall():")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    print(stock)")]),s._v("\n\nquery_sql "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SELECT * FROM stocks WHERE short=?"')]),s._v("\nshort_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"中集集团"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nshort_name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"' or 1=1 or '1\"")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("execute"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("query_sql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" short_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" stock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" cursor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fetchall"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("stock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者使用以下写法")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for stock in cursor.execute(query_sql):")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     print(stock)")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭连接")]),s._v("\nconn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("close"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[n("strong",[s._v("不应该使用 Python 的字符串操作来创建查询语句，会使程序容易受到 SQL 注入攻击 --\x3e 使用 "),n("code",[s._v("?")]),s._v(" 占位符来代替值，然后把对应的值组成的元组做为 "),n("code",[s._v("execute()")]),s._v(" 或 "),n("code",[s._v("executemany()")]),s._v(" 方法的第二个参数")]),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"sqlite3-模块的隐式事务管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sqlite3-模块的隐式事务管理"}},[s._v("#")]),s._v(" sqlite3 模块的隐式事务管理")]),s._v(" "),n("ul",[n("li",[s._v("sqlite3 模块在数据修改语言（DML）语句（即 "),n("code",[s._v("INSERT")]),s._v("/"),n("code",[s._v("UPDATE")]),s._v("/"),n("code",[s._v("DELETE")]),s._v("/"),n("code",[s._v("REPLACE")]),s._v("）之前隐式开启事务（执行 "),n("code",[s._v("BEGIN")]),s._v(" 语句 ）；")]),s._v(" "),n("li",[s._v("在非DML、非查询语句（上述语句之外的任何语句，如 "),n("code",[s._v("CREATE TABLE")]),s._v("、"),n("code",[s._v("SELECT")]),s._v(" ）之前隐式提交事务。")])]),s._v(" "),n("p",[n("code",[s._v("Connection")]),s._v(" 对象的 "),n("code",[s._v("isolation_level")]),s._v(" 参数可以控制 sqlite3 隐式执行的 "),n("code",[s._v("BEGIN")]),s._v(" 语句的种类：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("None")]),s._v(" 禁用 sqlite3 模块的隐式事务管理，使用 "),n("code",[s._v("autocommit")]),s._v(" 模式，在代码中显式地使用 "),n("code",[s._v("BEGIN")]),s._v(", "),n("code",[s._v("ROLLBACK")]),s._v(", "),n("code",[s._v("SAVEPOINT")]),s._v(" 和 "),n("code",[s._v("RELEASE")]),s._v(" 语句来完全控制事务状态。")]),s._v(" "),n("li",[n("code",[s._v("DEFERRED")]),s._v(" 默认值，使用 sqlite3 模块的隐式事务管理")]),s._v(" "),n("li",[n("code",[s._v("IMMEDIATE")])]),s._v(" "),n("li",[n("code",[s._v("EXCLUSIVE")])])]),s._v(" "),n("h2",{attrs:{id:"参考文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),n("ol",[n("li",[s._v("官网 "),n("a",{attrs:{href:"https://docs.python.org/3.5/library/sqlite3.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("sqlite3"),n("OutboundLink")],1),s._v(" 模块")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/ghaering/pysqlite",target:"_blank",rel:"noopener noreferrer"}},[s._v("pysqlite"),n("OutboundLink")],1),s._v(" （sqlite3 在外部使用 “pysqlite” 名字）")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.sqlite.org",target:"_blank",rel:"noopener noreferrer"}},[s._v("SQLite"),n("OutboundLink")],1),s._v(" 官网，其文档描述了它所支持的 SQL 语法和可用的数据类型。")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.python.org/dev/peps/pep-0249/",target:"_blank",rel:"noopener noreferrer"}},[s._v("DB-API 2.0 规范"),n("OutboundLink")],1),s._v(" （需科学上网）")])])])}),[],!1,null,null,null);t.default=e.exports}}]);