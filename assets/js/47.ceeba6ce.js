(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{410:function(s,t,a){"use strict";a.r(t);var n=a(25),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"smtp发送邮件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#smtp发送邮件"}},[s._v("#")]),s._v(" SMTP发送邮件")]),s._v(" "),a("p",[s._v("Python 内置模块 "),a("code",[s._v("email")]),s._v(" 负责构造邮件（包括邮件内容、主题、发件人和收件人信息），"),a("code",[s._v("smtplib")]),s._v(" 负责发送邮件。")]),s._v(" "),a("h2",{attrs:{id:"一、-发送纯文本邮件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、-发送纯文本邮件"}},[s._v("#")]),s._v(" 一、 发送纯文本邮件")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" parseaddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" formataddr\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("header "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Header\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" MIMEText\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" smtplib\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_format_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    邮件地址格式化\n    :param s: name <addr@example.com>\n    :return: realname, email_address\n    """')]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" parseaddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" formataddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构造发件人、收件人、smtp服务器信息")]),s._v("\nfrom_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'From: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npassword "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Password: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权密码")]),s._v("\nto_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'To: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsmtp_server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SMTP server: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# smtp.163.com 25")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构造邮件 纯文本邮件（邮件正文、mime的subtype -> text/plain、编码）")]),s._v("\nmsg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MIMEText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello world, send by xx管理员'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'plain'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'From'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _format_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx管理员 <%s>'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" from_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'To'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _format_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx用户 <%s>'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" to_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Subject'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx系统感谢您的注册'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建smtp连接")]),s._v("\nsmtp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" smtplib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SMTP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("smtp_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印发送到服务和从服务接收的所有消息")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("set_debuglevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录需要身份验证的SMTP服务器")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送邮件")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sendmail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("to_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 终止SMTP会话并关闭连接")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("ol",[a("li",[s._v("在自定义的名称地址格式化函数 "),a("code",[s._v("_format_addr")]),s._v(" 中，在主题、收件人等字段包含非 ASCII 字符时使用 "),a("code",[s._v("Header")]),s._v(" 包装。")]),s._v(" "),a("li",[s._v("MIME（Multipurpose Internet Mail Extensions） 多用途互联网邮件扩展类型，可以让浏览器使用指定应用程序打开对应类型文件。这里使用 "),a("code",[s._v("MIMEText")]),s._v(" 构造纯文本数据，创建之后为其添加 "),a("code",[s._v("From")]),s._v("、"),a("code",[s._v("To")]),s._v("、"),a("code",[s._v("Subject")]),s._v(" 等属性。")]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("smtplib.SMTP")]),s._v(" 创建 SMTP 连接，第一个参数为服务器地址，网易 163 邮箱的 smtp 服务器地址为 "),a("code",[s._v("smtp.163.com")]),s._v("， 非 SSL 协议的端口号为 25。")]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("smtp.login")]),s._v(" 登录 SMTP 服务器时的密码是授权密码，而不是登录密码。")])]),s._v(" "),a("h2",{attrs:{id:"二、-发送-html-邮件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、-发送-html-邮件"}},[s._v("#")]),s._v(" 二、 发送 HTML 邮件")]),s._v(" "),a("p",[s._v("将 "),a("code",[s._v("MIMEText")]),s._v(" 第二个参数设置为 "),a("code",[s._v("html")]),s._v(" 即可构造 HTML 文本的邮件：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MIMEText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v("'''\n    <html>\n    <body>\n        <h1>hello world</h1>\n        <p>send by xx管理员，点击以下链接激活账号 <a href=\"#\">链接xxxxxx</a></p>\n    </body>\n    </html>\n    '''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h2",{attrs:{id:"message-对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#message-对象"}},[s._v("#")]),s._v(" Message 对象")]),s._v(" "),a("p",[s._v("之前使用 "),a("code",[s._v("MIMEText")]),s._v(" 构造文本邮件（纯文本和 HTML 文本），本质它是一个 "),a("code",[s._v("email.message.Message")]),s._v(" 对象，部分继承结构如下：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Message\n+- MIMEBase\n   +- MIMEMultipart\n   +- MIMENonMultipart\n      +- MIMEText\n      +- MIMEImage\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("实现一个邮件内容就是构造一个 "),a("code",[s._v("Message")]),s._v(" 对象：")]),s._v(" "),a("ul",[a("li",[s._v("如果表示文本邮件，使用 "),a("code",[s._v("MIMEText")]),s._v(" 构造；")]),s._v(" "),a("li",[s._v("如果表示图片邮件，使用 "),a("code",[s._v("MIMEImage")]),s._v(" 构造；")]),s._v(" "),a("li",[s._v("如果要把多个邮件内容组合起来，使用 "),a("code",[s._v("MIMEMultipart")]),s._v(" 构造；")]),s._v(" "),a("li",[a("code",[s._v("MIMEBase")]),s._v(" 可以表示任何对象。")])]),s._v(" "),a("h2",{attrs:{id:"三、-发送带附件的邮件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、-发送带附件的邮件"}},[s._v("#")]),s._v(" 三、 发送带附件的邮件")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("MIMEMultipart")]),s._v(" 构造 "),a("code",[s._v("Message")]),s._v(" 对象，然后对其添加 "),a("code",[s._v("MIMEText")]),s._v(" 作为邮件正文，添加 "),a("code",[s._v("MIMEBase")]),s._v(" 表示附件。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" parseaddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" formataddr\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("header "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Header\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("base "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" MIMEBase\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("text "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" MIMEText\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("multipart "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" MIMEMultipart\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" email"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encoders "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" encode_base64\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" smtplib\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_format_addr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" parseaddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" formataddr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构造发件人、收件人、smtp服务器信息")]),s._v("\nfrom_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'From: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\npassword "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Password: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 授权密码")]),s._v("\nto_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'To: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nsmtp_server "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SMTP server: '")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# smtp.163.com 25")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构造邮件")]),s._v("\nmsg "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MIMEMultipart"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'From'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _format_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx管理员 <%s>'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" from_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'To'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _format_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx用户 <%s>'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" to_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Subject'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xx系统感谢您的注册'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MIMEText 作为邮件正文")]),s._v("\ntext "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MIMEText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello world, send by xx管理员'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'plain'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加到 MIMEMultipart")]),s._v("\nmsg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attach"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MIMEBase 表示附件（以本地读取的图片为例）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./1.jpeg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rb'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    appendix "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MIMEBase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'image'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jpeg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    appendix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Disposition'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'attachment'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" filename"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cat.jpeg'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 读取内容")]),s._v("\n    appendix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("set_payload"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Base64编码")]),s._v("\n    encode_base64"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("appendix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加到 MIMEMultipart")]),s._v("\n    msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attach"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("appendix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建smtp连接")]),s._v("\nsmtp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" smtplib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SMTP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("smtp_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打印发送到服务和从服务接收的所有消息")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("set_debuglevel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 登录需要身份验证的SMTP服务器")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("login"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送邮件")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sendmail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("to_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_string"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 终止SMTP会话并关闭连接")]),s._v("\nsmtp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("quit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br")])]),a("p",[a("code",[s._v("Message")]),s._v(" 对象的方法：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("attach")]),s._v(" 方法，将给定的 payload 载入到当前的 "),a("code",[s._v("payload")]),s._v("。调用之前当前的 "),a("code",[s._v("payload")]),s._v(" 必须是 "),a("code",[s._v("None")]),s._v(" 或者 "),a("code",[s._v("Message")]),s._v(" 组成的列表。")]),s._v(" "),a("li",[a("code",[s._v("set_payload")]),s._v(" 方法，将 scalar object（如 string）载入到当前的 "),a("code",[s._v("payload")]),s._v("。")]),s._v(" "),a("li",[a("code",[s._v("add_header")]),s._v(" 方法，添加 http header，效果如下："),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('Content-Disposition: attachment; filename="cat.jpeg"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",[a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Disposition",target:"_blank",rel:"noopener noreferrer"}},[s._v("MDN HTTP Content-Disposition"),a("OutboundLink")],1)])])]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("email.encoders")]),s._v(" 模块的 "),a("code",[s._v("encode_base64")]),s._v(" 方法将 "),a("code",[s._v("payload")]),s._v(" base64 编码，并自动设置 "),a("code",[s._v("Content-Transfer-Encoding")]),s._v(" 为 base64。")])]),s._v(" "),a("h2",{attrs:{id:"四、-发送带图片的邮件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、-发送带图片的邮件"}},[s._v("#")]),s._v(" 四、 发送带图片的邮件")]),s._v(" "),a("p",[s._v("方法一：直接在 HTML 文本中链接（网络）图片地址。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("text "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MIMEText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v("'''\n    <html>\n    <body>\n        <h1>hello world</h1>\n        <img src=\"http://n.sinaimg.cn/sinacn/w637h427/20180201/14cd-fyrcsrw4113824.jpg\">\n    </body>\n    </html>\n    '''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ps. 163 邮箱是可以的，有的邮件服务提供商会自动屏蔽带有外链的图片。")]),s._v(" "),a("p",[s._v("方法二：在“发送带附件的邮件”的基础上添加 "),a("code",[s._v("Content-ID")]),s._v(" 和 "),a("code",[s._v("X-Attachment-Id")]),s._v(" 头关联附件，然后在 HTML 中使用 "),a("code",[s._v('src="cid:0"')]),s._v(" 引用附件。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("appendix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-ID'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<0>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nappendix"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add_header"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-Attachment-Id'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("img")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("cid:0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"五、-加密的-smtp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、-加密的-smtp"}},[s._v("#")]),s._v(" 五、 加密的 SMTP")]),s._v(" "),a("p",[s._v("使用非 SSL 协议的 25 端口连接 SMTP 服务器时，使用的是明文传输，发送邮件的整个过程可能会被窃听。\n要更安全地发送邮件，可以加密 SMTP 会话，实际上就是先创建 SSL 安全连接，然后再使用 SMTP 协议发送邮件，修改代码如下：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建smtp连接")]),s._v("\nsmtp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" smtplib"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SMTP_SSL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("smtp_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("994")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("使用 SMTP_SSL 创建连接，并修改为指定端口（网易 163 使用 994 端口）。")]),s._v(" "),a("h2",{attrs:{id:"参考文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),a("ol",[a("li",[s._v("官网 "),a("a",{attrs:{href:"https://docs.python.org/3.5/library/email.html?highlight=email#module-email",target:"_blank",rel:"noopener noreferrer"}},[s._v("email"),a("OutboundLink")],1),s._v(" | "),a("a",{attrs:{href:""}},[s._v("smtplib")]),s._v(" | "),a("a",{attrs:{href:"https://docs.python.org/3.5/library/email.message.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("email.message"),a("OutboundLink")],1),s._v(" | "),a("a",{attrs:{href:"https://docs.python.org/3.5/library/email.mime.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("email.mime"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"http://help.163.com/09/1223/14/5R7P3QI100753VB8.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("163免费邮客户端设置的POP3、SMTP、IMAP地址"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("官网示例 "),a("a",{attrs:{href:"https://docs.python.org/3.5/library/email-examples.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("将目录的全部内容作为电子邮件发送的示例"),a("OutboundLink")],1),s._v(" | "),a("a",{attrs:{href:"https://docs.python.org/3.5/library/email-examples.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("将MIME消息解压到文件目录中的示例"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);