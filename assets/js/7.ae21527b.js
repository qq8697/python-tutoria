(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{364:function(t,s,a){t.exports=a.p+"assets/img/structformatfirstletter.c452519d.png"},365:function(t,s,a){t.exports=a.p+"assets/img/structformatcharacter.9465c92b.png"},419:function(t,s,a){"use strict";a.r(s);var r=a(25),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"二进制数据处理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#二进制数据处理"}},[t._v("#")]),t._v(" 二进制数据处理")]),t._v(" "),r("p",[r("code",[t._v("struct")]),t._v(" 模块将字节串解读为打包的二进制数据，\n该模块用于 "),r("strong",[t._v("Python值")]),t._v(" 和 "),r("strong",[t._v("以Python bytes对象表示的 C 结构")]),t._v("之间的转换。使用 "),r("a",{attrs:{href:"https://docs.python.org/3.5/library/struct.html#struct-format-strings",target:"_blank",rel:"noopener noreferrer"}},[t._v("Format Strings"),r("OutboundLink")],1),t._v(" 作为 C 结构的描述。")]),t._v(" "),r("h2",{attrs:{id:"struct-模块的函数"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#struct-模块的函数"}},[t._v("#")]),t._v(" struct 模块的函数")]),t._v(" "),r("ul",[r("li",[r("code",[t._v("pack(format, v1, v2, ...)")]),t._v(" 返回 "),r("code",[t._v("bytes")]),t._v(" 对象，包含根据格式字符串 "),r("code",[t._v("format")]),t._v(" 打包的值 "),r("code",[t._v("v1")]),t._v(", "),r("code",[t._v("v2")]),t._v(" ...，参数的个数必须与格式字符串匹配。")]),t._v(" "),r("li",[r("code",[t._v("pack_into(format, buffer, offset, v1, v2, ...)")]),t._v(" 将打包的字节串写入可写缓冲区 "),r("code",[t._v("buffer")]),t._v(" 从 "),r("code",[t._v("offset")]),t._v(" 开始的位置。")]),t._v(" "),r("li",[r("code",[t._v("unpack(format, buffer)")]),t._v(" 根据格式字符串 "),r("code",[t._v("format")]),t._v(" 从缓冲区 "),r("code",[t._v("buffer")]),t._v(" 解包（假定是由 "),r("code",[t._v("pack(format, ...)")]),t._v(" 打包）。\n"),r("ul",[r("li",[t._v("缓冲区的字节大小必须匹配格式所要求的大小。")])])]),t._v(" "),r("li",[r("code",[t._v("unpack_from(format, buffer, offset=0)")]),t._v("。\n"),r("ul",[r("li",[t._v("缓冲区的字节大小必须匹配格式所要求的大小。")])])]),t._v(" "),r("li",[r("code",[t._v("iter_unpack(format, buffer)")]),t._v(" 根据格式字符串 "),r("code",[t._v("format")]),t._v(" 以迭代方式从缓冲区 "),r("code",[t._v("buffer")]),t._v(" 解包。\n"),r("ul",[r("li",[t._v("缓冲区的字节大小必须整数倍于格式所要求的大小。")])])]),t._v(" "),r("li",[r("code",[t._v("calcsize(format)")]),t._v(" 返回与格式字符串 "),r("code",[t._v("format")]),t._v(" 相对应的结构体的大小。")])]),t._v(" "),r("h2",{attrs:{id:"格式字符串"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#格式字符串"}},[t._v("#")]),t._v(" 格式字符串")]),t._v(" "),r("p",[t._v("格式字符串：在打包/解包数据时指定数据的“结构”。")]),t._v(" "),r("h3",{attrs:{id:"字节顺序、大小和对齐方式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#字节顺序、大小和对齐方式"}},[t._v("#")]),t._v(" 字节顺序、大小和对齐方式")]),t._v(" "),r("p",[t._v("默认情况下，C 类型以机器的本机格式和字节顺序表示，并在必要时通过跳过填充字节进行正确对齐（根据 C 编译器使用的规则）。")]),t._v(" "),r("ul",[r("li",[t._v("本机字节顺序：可能为大端或是小端，取决于主机系统的不同，使用 "),r("code",[t._v("sys.byteorder")]),t._v(" 来检查系统字节顺序。")]),t._v(" "),r("li",[t._v("本机大小和对齐方式是使用 C 编译器的 "),r("code",[t._v("sizeof")]),t._v(" 表达式来确定的。 这总是会与本机字节顺序相绑定。")])]),t._v(" "),r("p",[t._v("或者，格式字符串的第一个字符指定打包数据的字节顺序、大小和对齐方式"),r("img",{attrs:{src:a(364),alt:""}})]),t._v(" "),r("ul",[r("li",[t._v("默认为 "),r("code",[t._v("'@'")])])]),t._v(" "),r("h3",{attrs:{id:"格式字符"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#格式字符"}},[t._v("#")]),t._v(" 格式字符")]),t._v(" "),r("p",[r("img",{attrs:{src:a(365),alt:""}})]),t._v(" "),r("p",[t._v("示例："),r("code",[t._v("'>IH'")]),t._v("， "),r("code",[t._v(">")]),t._v(" 表示大端，"),r("code",[t._v("I")]),t._v(" 表示4字节无符号整数，"),r("code",[t._v("H")]),t._v(" 表示2字节无符号整数")]),t._v(" "),r("h2",{attrs:{id:"example"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[t._v("#")]),t._v(" Example")]),t._v(" "),r("p",[t._v("以解析 .bmp 文件为例。"),r("br"),t._v("\nBMP格式采用小端方式存储数据，文件头的结构按顺序如下：")]),t._v(" "),r("ul",[r("li",[t._v("两个字节："),r("code",[t._v("'BM'")]),t._v(" 表示 Windows 位图，"),r("code",[t._v("'BA'")]),t._v(" 表示 OS/2 位图；")]),t._v(" "),r("li",[t._v("4字节整数：表示位图大小；")]),t._v(" "),r("li",[t._v("4字节整数：保留位，始终为 0；")]),t._v(" "),r("li",[t._v("4字节整数：实际图像的偏移量；")]),t._v(" "),r("li",[t._v("4字节整数："),r("code",[t._v("Header")]),t._v(" 的字节数；")]),t._v(" "),r("li",[t._v("4字节整数：图像宽度；")]),t._v(" "),r("li",[t._v("4字节整数：图像高度；")]),t._v(" "),r("li",[t._v("2字节整数：始终为 1；")]),t._v(" "),r("li",[t._v("2字节整数：颜色数。")])]),t._v(" "),r("p",[t._v("所以，格式字符串为 "),r("code",[t._v("<2sIIIIIIHH")]),t._v("。")]),t._v(" "),r("p",[t._v("使用 “画图” 软件创建空白位图文件 example.bmp。"),r("br"),t._v("\n解析 .bmp 文件代码如下：")]),t._v(" "),r("div",{staticClass:"language-python line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-python"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" collections "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" namedtuple\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" struct "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" unpack"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pack\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'example.bmp'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rb'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    s "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" f"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("read"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# b'BM\\x0e\\xf9\\x16\\x00\\x00\\x00\\x00\\x006\\x00\\x00\\x00(\\x00\\x00\\x00S\\x02\\x00\\x00J\\x03\\x00\\x00\\x01\\x00\\x18\\x00'")]),t._v("\n\n    BMP "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" namedtuple"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'BMP'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'platform long retain1 offset header width height retain2 colors'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    b "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BMP"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_make"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("unpack"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<2sIIIIIIHH'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" s"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# BMP(platform=b'BM', long=1505550, retain1=0, offset=54, header=40, width=595, height=842, retain2=1, colors=24)")]),t._v("\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br"),r("span",{staticClass:"line-number"},[t._v("4")]),r("br"),r("span",{staticClass:"line-number"},[t._v("5")]),r("br"),r("span",{staticClass:"line-number"},[t._v("6")]),r("br"),r("span",{staticClass:"line-number"},[t._v("7")]),r("br"),r("span",{staticClass:"line-number"},[t._v("8")]),r("br"),r("span",{staticClass:"line-number"},[t._v("9")]),r("br"),r("span",{staticClass:"line-number"},[t._v("10")]),r("br")])]),r("p",[t._v("ps. 可以将解包的字段包装为一个命名元组")]),t._v(" "),r("h2",{attrs:{id:"参考文档"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),r("ol",[r("li",[t._v("官网 "),r("a",{attrs:{href:"https://docs.python.org/3.5/library/struct.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("struct"),r("OutboundLink")],1),t._v(" | "),r("a",{attrs:{href:"https://docs.python.org/3.5/library/struct.html#struct-format-strings",target:"_blank",rel:"noopener noreferrer"}},[t._v("Format Strings"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);